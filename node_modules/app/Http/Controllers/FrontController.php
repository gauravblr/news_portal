<?php

namespace App\Http\Controllers;

use App\Models\Category;
use App\Models\Post;
use App\Models\User;
use Illuminate\Http\Request;

class FrontController extends Controller
{
    protected $post = null;
    protected $category = null;
    protected $user = null;

    public function __construct(Post $post,Category $category,User $user)
    {
        $this->post = $post;
        $this->category = $category;
        $this->user = $user;
    }

    public function homepage(){
        return view('frontend.pages.index');
    }

    public function singlePost($slug){
        $data = $this->post->where('slug', $slug)->first();
        if(!$data) {
            request()->session()->flash('error','Post not found');
            return redirect()->back();
        }
        return view('frontend.pages.single', compact('data'));
    }

    public function category($slug){
        $category_data = $this->category->where('slug', $slug)->first();
        $data = $this->post->where('category_id', $category_data->id)->where('status', 'publish')->paginate(4);
        return view('frontend.pages.category', compact('data'));
    }

    public function writer($slug){
        $writer_detail = $this->user->where('slug', $slug)->first();
        $data = $this->post->where('author_id', $writer_detail->id)->where('status', 'publish')->paginate(10);
        return view('frontend.pages.author', compact('data'));
    }

    public function search(Request $request){
        $posts = Post::query();
        $word = trim($request->keyword);
        if($word && !empty($word)){
               $posts->where('title', 'LIKE', '%' . $word . '%')
                ->orWhere('excerpt', 'LIKE', '%' . $word . '%')
                ->orWhere('description', 'LIKE', '%' . $word . '%');
        }
        $data = $posts->paginate(10);
        return view('frontend.pages.search', compact('data', 'word'));
    }
}
